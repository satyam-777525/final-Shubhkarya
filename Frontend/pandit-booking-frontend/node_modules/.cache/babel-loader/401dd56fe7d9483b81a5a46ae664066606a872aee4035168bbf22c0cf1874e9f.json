{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import{io}from'socket.io-client';// Use your deployed backend URL here to connect Socket.IO\nimport{jsxs as _jsxs,jsx as _jsx}from\"react/jsx-runtime\";const BACKEND_URL='http://localhost:5000';// Create Socket.IO client instance\nconst socket=io(BACKEND_URL,{autoConnect:false,transports:['websocket','polling']});function ChatWindow(_ref){let{userId,panditId,onClose,chatName}=_ref;const[messages,setMessages]=useState([]);const[input,setInput]=useState('');const roomId=`${userId}_${panditId}`;// Ensures same room on both sides\nconst messagesEndRef=useRef(null);// Track sent messages to avoid duplicates\nconst sentMessageIds=useRef(new Set());useEffect(()=>{socket.connect();socket.emit('joinRoom',roomId);socket.on('receiveMessage',msg=>{const msgId=`${msg.timestamp}_${msg.senderId}`;if(sentMessageIds.current.has(msgId)){return;// Ignore duplicate message\n}setMessages(prev=>[...prev,msg]);});return()=>{socket.off('receiveMessage');socket.disconnect();sentMessageIds.current.clear();};},[roomId]);useEffect(()=>{var _messagesEndRef$curre;(_messagesEndRef$curre=messagesEndRef.current)===null||_messagesEndRef$curre===void 0?void 0:_messagesEndRef$curre.scrollIntoView({behavior:'smooth'});},[messages]);const sendMessage=()=>{if(!input.trim())return;const msgObj={roomId,senderId:userId,message:input,timestamp:Date.now()};sentMessageIds.current.add(`${msgObj.timestamp}_${msgObj.senderId}`);setMessages(prev=>[...prev,msgObj]);socket.emit('sendMessage',msgObj);setInput('');};return/*#__PURE__*/_jsxs(\"div\",{style:{position:'fixed',bottom:0,right:0,width:350,height:400,border:'1px solid #ccc',backgroundColor:'white',display:'flex',flexDirection:'column',boxShadow:'0 0 10px rgba(0,0,0,0.3)',zIndex:9999},children:[/*#__PURE__*/_jsxs(\"div\",{style:{padding:10,borderBottom:'1px solid #ddd',backgroundColor:'#f5f5f5'},children:[/*#__PURE__*/_jsxs(\"strong\",{children:[\"Chat with \",chatName]}),/*#__PURE__*/_jsx(\"button\",{onClick:onClose,style:{float:'right',border:'none',background:'transparent',cursor:'pointer'},\"aria-label\":\"Close chat\",children:\"\\u2716\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:{flex:1,overflowY:'auto',padding:10,fontSize:14},children:[messages.map((msg,i)=>/*#__PURE__*/_jsx(\"div\",{style:{marginBottom:8,textAlign:msg.senderId===userId?'right':'left'},children:/*#__PURE__*/_jsx(\"span\",{style:{display:'inline-block',backgroundColor:msg.senderId===userId?'#DCF8C6':'#EEE',padding:'6px 12px',borderRadius:20,maxWidth:'80%',wordWrap:'break-word'},children:msg.message})},i)),/*#__PURE__*/_jsx(\"div\",{ref:messagesEndRef})]}),/*#__PURE__*/_jsxs(\"div\",{style:{padding:10,borderTop:'1px solid #ddd',display:'flex'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Type a message\",value:input,onChange:e=>setInput(e.target.value),onKeyDown:e=>{if(e.key==='Enter')sendMessage();},style:{flex:1,marginRight:5,padding:8},\"aria-label\":\"Message input\"}),/*#__PURE__*/_jsx(\"button\",{onClick:sendMessage,\"aria-label\":\"Send message\",children:\"Send\"})]})]});}export default ChatWindow;","map":{"version":3,"names":["React","useState","useEffect","useRef","io","jsxs","_jsxs","jsx","_jsx","BACKEND_URL","socket","autoConnect","transports","ChatWindow","_ref","userId","panditId","onClose","chatName","messages","setMessages","input","setInput","roomId","messagesEndRef","sentMessageIds","Set","connect","emit","on","msg","msgId","timestamp","senderId","current","has","prev","off","disconnect","clear","_messagesEndRef$curre","scrollIntoView","behavior","sendMessage","trim","msgObj","message","Date","now","add","style","position","bottom","right","width","height","border","backgroundColor","display","flexDirection","boxShadow","zIndex","children","padding","borderBottom","onClick","float","background","cursor","flex","overflowY","fontSize","map","i","marginBottom","textAlign","borderRadius","maxWidth","wordWrap","ref","borderTop","type","placeholder","value","onChange","e","target","onKeyDown","key","marginRight"],"sources":["C:/Users/sv106/OneDrive/Desktop/Shubhkarya/Frontend/pandit-booking-frontend/src/pages/ChatWindow.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { io } from 'socket.io-client';\r\n\r\n// Use your deployed backend URL here to connect Socket.IO\r\nconst BACKEND_URL = 'http://localhost:5000';\r\n\r\n// Create Socket.IO client instance\r\nconst socket = io(BACKEND_URL, {\r\n  autoConnect: false,\r\n  transports: ['websocket', 'polling'],\r\n});\r\n\r\nfunction ChatWindow({ userId, panditId, onClose, chatName }) {\r\n  const [messages, setMessages] = useState([]);\r\n  const [input, setInput] = useState('');\r\n  const roomId = `${userId}_${panditId}`; // Ensures same room on both sides\r\n  const messagesEndRef = useRef(null);\r\n\r\n  // Track sent messages to avoid duplicates\r\n  const sentMessageIds = useRef(new Set());\r\n\r\n  useEffect(() => {\r\n    socket.connect();\r\n    socket.emit('joinRoom', roomId);\r\n\r\n    socket.on('receiveMessage', (msg) => {\r\n      const msgId = `${msg.timestamp}_${msg.senderId}`;\r\n      if (sentMessageIds.current.has(msgId)) {\r\n        return; // Ignore duplicate message\r\n      }\r\n      setMessages(prev => [...prev, msg]);\r\n    });\r\n\r\n    return () => {\r\n      socket.off('receiveMessage');\r\n      socket.disconnect();\r\n      sentMessageIds.current.clear();\r\n    };\r\n  }, [roomId]);\r\n\r\n  useEffect(() => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n  }, [messages]);\r\n\r\n  const sendMessage = () => {\r\n    if (!input.trim()) return;\r\n\r\n    const msgObj = {\r\n      roomId,\r\n      senderId: userId,\r\n      message: input,\r\n      timestamp: Date.now(),\r\n    };\r\n\r\n    sentMessageIds.current.add(`${msgObj.timestamp}_${msgObj.senderId}`);\r\n\r\n    setMessages(prev => [...prev, msgObj]);\r\n    socket.emit('sendMessage', msgObj);\r\n    setInput('');\r\n  };\r\n\r\n  return (\r\n    <div style={{\r\n      position: 'fixed', bottom: 0, right: 0, width: 350, height: 400,\r\n      border: '1px solid #ccc', backgroundColor: 'white', display: 'flex',\r\n      flexDirection: 'column', boxShadow: '0 0 10px rgba(0,0,0,0.3)', zIndex: 9999\r\n    }}>\r\n      <div style={{ padding: 10, borderBottom: '1px solid #ddd', backgroundColor: '#f5f5f5' }}>\r\n        <strong>Chat with {chatName}</strong>\r\n        <button\r\n          onClick={onClose}\r\n          style={{ float: 'right', border: 'none', background: 'transparent', cursor: 'pointer' }}\r\n          aria-label=\"Close chat\"\r\n        >\r\n          âœ–\r\n        </button>\r\n      </div>\r\n      <div style={{ flex: 1, overflowY: 'auto', padding: 10, fontSize: 14 }}>\r\n        {messages.map((msg, i) => (\r\n          <div key={i} style={{ marginBottom: 8, textAlign: msg.senderId === userId ? 'right' : 'left' }}>\r\n            <span style={{\r\n              display: 'inline-block',\r\n              backgroundColor: msg.senderId === userId ? '#DCF8C6' : '#EEE',\r\n              padding: '6px 12px',\r\n              borderRadius: 20,\r\n              maxWidth: '80%',\r\n              wordWrap: 'break-word',\r\n            }}>\r\n              {msg.message}\r\n            </span>\r\n          </div>\r\n        ))}\r\n        <div ref={messagesEndRef} />\r\n      </div>\r\n      <div style={{ padding: 10, borderTop: '1px solid #ddd', display: 'flex' }}>\r\n        <input\r\n          type=\"text\"\r\n          placeholder=\"Type a message\"\r\n          value={input}\r\n          onChange={e => setInput(e.target.value)}\r\n          onKeyDown={e => { if (e.key === 'Enter') sendMessage() }}\r\n          style={{ flex: 1, marginRight: 5, padding: 8 }}\r\n          aria-label=\"Message input\"\r\n        />\r\n        <button onClick={sendMessage} aria-label=\"Send message\">Send</button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default ChatWindow;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}